<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chatbot</title>
    <script>
        let isRegistered = false; // Track if user filled form

        async function registerUser(event) {
            event.preventDefault();
            const name = document.getElementById("name").value.trim();
            const email = document.getElementById("email").value.trim();
            const phone = document.getElementById("phone").value.trim();

            if (!name || !email || !phone) {
                alert("Please fill all fields.");
                return;
            }

            const response = await fetch("/start", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ name, email, phone }),
            });

            const result = await response.json();
            if (response.ok) {
                document.getElementById("registration-form").style.display = "none";
                document.getElementById("chat-interface").style.display = "block";
                isRegistered = true;
                alert("Welcome! Now you can start chatting.");
            } else {
                alert("Error registering: " + result.error);
            }
        }

        async function sendMessage() {
            const userInput = document.getElementById("user-input").value.trim();
            if (!userInput) return;
            if (!isRegistered) {
                alert("Please register first.");
                return;
            }

            const response = await fetch("/ask", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ message: userInput }),
            });

            const data = await response.json();
            document.getElementById("chat-box").innerHTML += `<div><b>You:</b> ${userInput}</div>`;
            document.getElementById("chat-box").innerHTML += `<div><b>Bot:</b> ${data.response}</div>`;
            document.getElementById("user-input").value = "";
        }
    </script>
</head>
<body>
    <div id="registration-form">
        <h2>Enter your information to start</h2>
        <form onsubmit="registerUser(event)">
            <input type="text" id="name" placeholder="Name" required><br><br>
            <input type="email" id="email" placeholder="Email" required><br><br>
            <input type="text" id="phone" placeholder="Phone" required><br><br>
            <button type="submit">Start Chat</button>
        </form>
    </div>

    <div id="chat-interface" style="display:none;">
        <h2>Chatbot</h2>
        <div id="chat-box" style="border:1px solid #ccc; height:300px; overflow:auto; padding:10px;"></div><br>
        <input type="text" id="user-input" placeholder="Type your message..." style="width:70%;">
        <button onclick="sendMessage()">Send</button>
    </div>
</body>
</html>
